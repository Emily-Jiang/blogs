---
layout: post
title: "TITLE"
# Do NOT change the categories section
categories: blog
author_picture: https://avatars3.githubusercontent.com/GITHUB_USERNAME
author_github: https://github.com/GITHUB_USERNAME
seo-title: TITLE - OpenLiberty.io
seo-description: DESCRIPTION
blog_description: "DESCRIPTION"
open-graph-image: https://openliberty.io/img/twitter_card.jpg
open-graph-image-alt: Open Liberty Logo
additional_authors: 
- name: Monica Tamboli
  github: https://github.com/SECOND_GITHUB_USERNAME
  image: https://avatars0.githubusercontent.com/SECOND_GITHUB_USERNAME
- name: THIRD_AUTHOR_NAME
  github: https://github.com/THIRD_GITHUB_USERNAME
  image: https://avatars0.githubusercontent.com/THIRD_GITHUB_USERNAME
---
= A Solution to Configuration Drift - Deploying Open Liberty with GitOps 
Daniel Guinan <https://github.com/GITHUB_USERNAME>
:imagesdir: /
:url-prefix:
:url-about: /
//Blank line here is necessary before starting the body of the post.

// // // // // // // //
// In the preceding section:
// Do not insert any blank lines between any of the lines.
//
// "open-graph-image" is set to OL logo. Whenever possible update this to a more appropriate/specific image (for example if present an image that is being used in the post). 
// However, it can be left empty which will set it to the default
//
// "open-graph-image-alt" is a description of what is in the image (not a caption). When changing "open-graph-image" to
// a custom picture, you must provide a custom string for "open-graph-image-alt".
//
// Replace TITLE with the blog post title
//
// Replace SECOND_AUTHOR_NAME with the name of the second author.
// Replace SECOND_GITHUB_USERNAME with the GitHub user name of the second author.
// Replace THIRD_AUTHOR_NAME with the name of the third author. And so on for fourth, fifth, etc authors.
// Replace THIRD_GITHUB_USERNAME with the GitHub user name of the third author. And so on for fourth, fifth, etc authors.
//
// Replace AUTHOR_NAME with your name as first author.
// Replace GITHUB_USERNAME with your GitHub username eg: lauracowen
// Replace DESCRIPTION with a short summary (~60 words) of the release (a more succinct version of the first paragraph of the post).
//
// Replace AUTHOR_NAME with your name as you'd like it to be displayed, eg: Laura Cowen
//
// Example post: 2020-02-12-faster-startup-Java-applications-criu.adoc
//
// If adding image into the post add :
// -------------------------
// [.img_border_light]
// image::img/blog/FILE_NAME[IMAGE CAPTION ,width=70%,align="center"]
// -------------------------
// "[.img_border_light]" = This adds a faint grey border around the image to make its edges sharper. Use it around
// screenshots but not around diagrams. Then double check how it looks.
// There is also a "[.img_border_dark]" class which tends to work best with screenshots that are taken on dark backgrounds.
// Once again make sure to double check how it looks
// Change "FILE_NAME" to the name of the image file. Also make sure to put the image into the right folder which is: img/blog
// change the "IMAGE CAPTION" to a couple words of what the image is
// // // // // // // //
In today's modern software ecosystem, while many organizations have embraced Continuous Integration and Continuous Deployment (CI/CD) methodologies, they still grapple with the persistent issue of configuration drift. This refers to the disparity between configurations as coded in repositories like Git and what's actively deployed. This drift not only complicates deployments but can also jeopardize the stability of production environments. So, how can we reconcile this gap and ensure consistency across our deployments?

The answer lies in GitOps — a principle that revolves around using Git as the single source of truth for declarative infrastructure and applications. In this blog, we delve into harnessing the power of the GitOps framework and the deployment tool ArgoCD, to combat configuration drift. As a practical example, we'll spotlight the deployment of Open Liberty applications—a lightweight cloud-native Java runtime—onto Kubernetes/OpenShift clusters. And while our demonstration leans on specific tools; you can seamlessly integrate the CI/CD tools of your preference.

== What is Configuration Drift? ==
Configuration drift by definition is when a system’s configuration does not match what is expected or required.  Differences in configuration cause it to slowly “drift” away from what it should be.  The cause of drift can be many different things, however the most common reason is manual untracked changes made to a system.  This becomes more common as scale increases as more systems give more opportunity for drift.  If left alone, drift can become very time consuming to address.  Drift can potentially be dangerous when the drift leaves vulnerabilities unpatched or security rules missing.

== What is GitOps/ArgoCD ==
A GitOps framework is Infrastructure as Code used along side best practices for application development.  The key point being that Git is used as the single source of truth for configuration.  This framework provides the benefits of repeatability, stability, and consistency.  ArgoCD is a declarative continuous delivery tool for kubernetes that uses a GitOps pattern.  It is responsible for monitoring and comparing the actual state of the cluster to the desired state specified in the Git repository.  If the actual state of the cluster does not match the desired state ArgoCD will make changes to ensure they are in sync.  

== CI SECTION ==
(Is there a CI blog somewhere?) This blog will focus more on the CD aspect of GitOps, however, in order to effectively deploy with GitOps it is crucial to have a solid CI pipeline in place to build your Open Liberty Applications.  In our experience we found it more effective to separate the CI/CD pipelines into two smaller, less complex pipelines.  This also allowed us to reuse our existing pipeline and use tools we were already familiar with.  If you have no existing CI pipeline there are many great tools out there that can be used to build a pipeline, including open source options of Jenkins and Tekton.  Our CI pipeline consists of compiling the code upon commit, running tests, running security scans, and finally building a Docker image to be deployed with out CD pipeline.

== Install ArgoCD ==
To install ArgoCD simply run these commands from the Quickstart section of the docs:
```
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
```
This will create a new namespace named argocd as well as apply the install manifests to that namespace.  It alternatively can be installed via OLM.

== Install the Open Liberty Operator ==
The Open Liberty Operator assists in the deployment and management of Open Liberty Applications on Kubernetes.  To install it with the default configuration of watching all namespaces, clone the repository and run the following commands:
```
git clone https://github.com/OpenLiberty/open-liberty-operator.git
cd deploy/releases/1.2.1/kustomize/
kubectl apply --server-side -k open-liberty-operator/deploy/releases/1.2.2/kustomize/overlays/watch-all-namespaces
```
This can also be installed via OLM.
// // // // // // // //
// LINKS
//
// OpenLiberty.io site links:
// link:/guides/microprofile-rest-client.html[Consuming RESTful Java microservices]
// 
// Off-site links:
// link:https://openapi-generator.tech/docs/installation#jar[Download Instructions]
//
// // // // // // // //
